<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nexariq AI - Enterprise Agentic Platform</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600&family=Space+Grotesk:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/4.3.0/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/2.4.7/purify.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
    <style>
        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --secondary: #8b5cf6;
            --accent: #ec4899;
            --background: #0f0f0f;
            --surface: #1a1a1a;
            --surface-elevated: #252525;
            --surface-highlight: #2a2a2a;
            --border: #333333;
            --text-primary: #ffffff;
            --text-secondary: #a0a0a0;
            --text-tertiary: #808080;
            --success: #10b981;
            --warning: #f59e0b;
            --error: #ef4444;
            --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.05);
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --shadow-md: 0 10px 15px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 20px 25px rgba(0, 0, 0, 0.1);
            --radius-sm: 0.375rem;
            --radius: 0.5rem;
            --radius-lg: 0.75rem;
            --transition: all 0.2s ease;
            --logo-size: 40px;
            --gradient-primary: linear-gradient(135deg, #6366f1 0%, #8b5cf6 50%, #ec4899 100%);
            --gradient-accent: linear-gradient(135deg, #ec4899 0%, #8b5cf6 100%);
            --code-bg: #f6f8fa;
            --code-border: #e1e4e8;
            --code-text: #24292e;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--background);
            color: var(--text-primary);
            line-height: 1.6;
            overflow: hidden;
            height: 100vh;
        }

        /* App Container */
        .app-container {
            display: flex;
            height: 100vh;
            overflow: hidden;
        }

        /* Sidebar */
        .sidebar {
            width: 260px;
            background-color: var(--surface);
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            transition: var(--transition);
            z-index: 10;
        }

        .sidebar-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-family: 'Space Grotesk', sans-serif;
            font-weight: 700;
            font-size: 1.25rem;
            color: var(--text-primary);
            text-decoration: none;
            margin-bottom: 1rem;
            position: relative;
        }

        .logo-icon {
            width: var(--logo-size);
            height: var(--logo-size);
            border-radius: 50%;
            background-image: url('https://z-cdn-media.chatglm.cn/files/a3b6cc91-8760-4855-9412-fc384c34a732_circle_logo.png?auth_key=1790172879-f02d7001ca6d41e49a24fca3f9749bc3-0-c2777841a7a52c66653d70aedfc6efdb');
            background-size: cover;
            background-position: center;
            box-shadow: 0 0 20px rgba(139, 92, 246, 0.3);
            animation: logoGlow 3s ease-in-out infinite alternate;
        }

        @keyframes logoGlow {
            0% { box-shadow: 0 0 5px rgba(139, 92, 246, 0.3); }
            100% { box-shadow: 0 0 20px rgba(139, 92, 246, 0.6); }
        }

        .logo-text {
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: 0.5px;
        }

        .new-chat-btn {
            width: 100%;
            padding: 0.75rem;
            background-color: var(--surface-highlight);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            color: var(--text-primary);
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .new-chat-btn:hover {
            background-color: var(--surface-elevated);
        }

        .chat-history {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
        }

        .chat-history-title {
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--text-tertiary);
            text-transform: uppercase;
            margin-bottom: 0.75rem;
        }

        .chat-item {
            padding: 0.75rem;
            border-radius: var(--radius);
            cursor: pointer;
            transition: var(--transition);
            margin-bottom: 0.25rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .chat-item:hover {
            background-color: var(--surface-highlight);
        }

        .chat-item.active {
            background-color: var(--primary);
        }

        .chat-item-icon {
            width: 32px;
            height: 32px;
            border-radius: var(--radius-sm);
            background-color: var(--surface-elevated);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-secondary);
        }

        .chat-item-content {
            flex: 1;
            min-width: 0;
        }

        .chat-item-title {
            font-weight: 500;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .chat-item-date {
            font-size: 0.75rem;
            color: var(--text-tertiary);
        }

        .sidebar-footer {
            padding: 1rem;
            border-top: 1px solid var(--border);
        }

        .user-menu {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem;
            border-radius: var(--radius);
            cursor: pointer;
            transition: var(--transition);
        }

        .user-menu:hover {
            background-color: var(--surface-highlight);
        }

        .user-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: var(--gradient-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
        }

        .user-info {
            flex: 1;
            min-width: 0;
        }

        .user-name {
            font-weight: 500;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .user-email {
            font-size: 0.75rem;
            color: var(--text-tertiary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* Header */
        .header {
            height: 64px;
            background-color: var(--surface);
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 1.5rem;
            z-index: 5;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .mobile-menu-btn {
            display: none;
            background: none;
            border: none;
            color: var(--text-primary);
            font-size: 1.25rem;
            cursor: pointer;
        }

        .header-title {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 1.125rem;
            font-weight: 600;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .header-btn {
            width: 36px;
            height: 36px;
            border-radius: var(--radius);
            background-color: transparent;
            border: 1px solid var(--border);
            color: var(--text-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
        }

        .header-btn:hover {
            background-color: var(--surface-highlight);
        }

        /* Chat Container */
        .chat-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .message {
            display: flex;
            gap: 1rem;
            max-width: 90%;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .message.user {
            align-self: flex-end;
            flex-direction: row-reverse;
        }

        .message.ai {
            align-self: flex-start;
        }

        .message-avatar {
            width: 36px;
            height: 36px;
            border-radius: var(--radius);
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
        }

        .message.user .message-avatar {
            background: var(--gradient-primary);
            color: white;
        }

        .message.ai .message-avatar {
            background-image: url('https://z-cdn-media.chatglm.cn/files/a3b6cc91-8760-4855-9412-fc384c34a732_circle_logo.png?auth_key=1790172879-f02d7001ca6d41e49a24fca3f9749bc3-0-c2777841a7a52c66653d70aedfc6efdb');
            background-size: cover;
            background-position: center;
            box-shadow: 0 0 10px rgba(139, 92, 246, 0.5);
        }

        .message-content {
            background-color: var(--surface-elevated);
            border-radius: var(--radius-lg);
            padding: 1rem 1.25rem;
            position: relative;
        }

        .message.user .message-content {
            background: var(--gradient-primary);
            color: white;
            border-bottom-right-radius: var(--radius-sm);
        }

        .message.ai .message-content {
            border-bottom-left-radius: var(--radius-sm);
        }

        .message-text {
            line-height: 1.6;
        }

        .message-text pre {
            background-color: var(--code-bg);
            border-radius: var(--radius);
            padding: 1rem;
            overflow-x: auto;
            margin: 0.75rem 0;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.875rem;
            border: 1px solid var(--code-border);
            color: var(--code-text);
        }

        .message-text code {
            font-family: 'JetBrains Mono', monospace;
            background-color: rgba(255, 255, 255, 0.1);
            padding: 0.125rem 0.25rem;
            border-radius: 0.25rem;
            font-size: 0.875em;
        }

        .message-text ul, .message-text ol {
            margin-left: 1.5rem;
            margin-top: 0.5rem;
            margin-bottom: 0.5rem;
        }

        .message-text h1, .message-text h2, .message-text h3 {
            margin-top: 1rem;
            margin-bottom: 0.5rem;
        }

        .message-actions {
            display: flex;
            gap: 0.5rem;
            margin-top: 0.75rem;
            opacity: 0;
            transition: opacity 0.2s ease;
        }

        .message:hover .message-actions {
            opacity: 1;
        }

        .message-action-btn {
            width: 28px;
            height: 28px;
            border-radius: var(--radius-sm);
            background-color: rgba(255, 255, 255, 0.1);
            border: none;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
        }

        .message-action-btn:hover {
            background-color: rgba(255, 255, 255, 0.2);
            color: var(--text-primary);
        }

        .message-time {
            font-size: 0.75rem;
            color: var(--text-tertiary);
            margin-top: 0.25rem;
        }

        /* Typing Indicator */
        .typing-indicator {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 1rem;
            background-color: var(--surface-elevated);
            border-radius: var(--radius-lg);
            border-bottom-left-radius: var(--radius-sm);
            width: fit-content;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: var(--text-tertiary);
            animation: typing 1.4s infinite;
        }

        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typing {
            0%, 60%, 100% {
                transform: translateY(0);
                opacity: 0.7;
            }
            30% {
                transform: translateY(-10px);
                opacity: 1;
            }
        }

        /* Chat Input */
        .chat-input-container {
            padding: 1.5rem;
            background-color: var(--surface);
            border-top: 1px solid var(--border);
        }

        .chat-input-wrapper {
            background-color: var(--surface-elevated);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            padding: 1rem;
            display: flex;
            align-items: flex-end;
            gap: 0.75rem;
            transition: var(--transition);
        }

        .chat-input-wrapper:focus-within {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        .chat-input {
            flex: 1;
            background: none;
            border: none;
            color: var(--text-primary);
            font-size: 1rem;
            resize: none;
            outline: none;
            max-height: 200px;
            line-height: 1.5;
            font-family: inherit;
        }

        .chat-input::placeholder {
            color: var(--text-tertiary);
        }

        .chat-actions {
            display: flex;
            gap: 0.5rem;
        }

        .chat-action-btn {
            width: 36px;
            height: 36px;
            border-radius: var(--radius);
            background-color: transparent;
            border: none;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
        }

        .chat-action-btn:hover {
            background-color: var(--surface-highlight);
            color: var(--text-primary);
        }

        .chat-send-btn {
            width: 36px;
            height: 36px;
            border-radius: var(--radius);
            background: var(--gradient-primary);
            border: none;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
        }

        .chat-send-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .chat-send-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        /* Code Block Styles */
        .code-block {
            margin-top: 1rem;
            border-radius: 8px;
            overflow: hidden;
            background-color: var(--code-bg);
            border: 1px solid var(--code-border);
        }

        .code-header {
            background-color: #f1f3f4;
            padding: 0.5rem 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.875rem;
            color: #586069;
            border-bottom: 1px solid var(--code-border);
        }

        .code-language {
            font-weight: 600;
            text-transform: uppercase;
            color: #24292e;
        }

        .copy-btn {
            background-color: #f1f3f4;
            border: 1px solid #d1d5da;
            color: #24292e;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.25rem;
            transition: all 0.2s;
        }

        .copy-btn:hover {
            background-color: #e1e4e8;
            color: #24292e;
        }

        .copy-btn.copied {
            background-color: #2ea44f;
            color: white;
            border-color: #2ea44f;
        }

        /* Typing Effect */
        .typing-text {
            overflow: hidden;
            white-space: pre-wrap;
        }

        /* Settings Panel */
        .settings-panel {
            position: fixed;
            right: -400px;
            top: 0;
            width: 400px;
            height: 100vh;
            background-color: var(--surface);
            border-left: 1px solid var(--border);
            box-shadow: var(--shadow-lg);
            z-index: 100;
            display: flex;
            flex-direction: column;
            transition: right 0.3s ease;
        }

        .settings-panel.active {
            right: 0;
        }

        .settings-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .settings-title {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 1.125rem;
            font-weight: 600;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .settings-close {
            width: 36px;
            height: 36px;
            border-radius: var(--radius);
            background-color: transparent;
            border: none;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
        }

        .settings-close:hover {
            background-color: var(--surface-highlight);
            color: var(--text-primary);
        }

        .settings-content {
            flex: 1;
            overflow-y: auto;
            padding: 1.5rem;
        }

        .settings-section {
            margin-bottom: 2rem;
        }

        .settings-section-title {
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: 1rem;
            text-transform: uppercase;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--text-primary);
        }

        .form-input {
            width: 100%;
            background-color: var(--surface-elevated);
            border: 1px solid var(--border);
            border-radius: 6px;
            padding: 0.75rem;
            color: var(--text-primary);
            font-size: 1rem;
            outline: none;
            transition: border-color 0.2s;
        }

        .form-input:focus {
            border-color: var(--primary);
        }

        .form-text {
            font-size: 0.875rem;
            color: var(--text-tertiary);
            margin-top: 0.25rem;
        }

        .settings-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.75rem 0;
            border-bottom: 1px solid var(--border);
        }

        .settings-item:last-child {
            border-bottom: none;
        }

        .settings-label {
            font-weight: 500;
        }

        .settings-description {
            font-size: 0.75rem;
            color: var(--text-tertiary);
            margin-top: 0.25rem;
        }

        .settings-toggle {
            position: relative;
            width: 48px;
            height: 24px;
            background-color: var(--surface-highlight);
            border-radius: 12px;
            cursor: pointer;
            transition: var(--transition);
        }

        .settings-toggle.active {
            background-color: var(--primary);
        }

        .settings-toggle-slider {
            position: absolute;
            top: 2px;
            left: 2px;
            width: 20px;
            height: 20px;
            background-color: white;
            border-radius: 50%;
            transition: var(--transition);
        }

        .settings-toggle.active .settings-toggle-slider {
            transform: translateX(24px);
        }

        .settings-select {
            background-color: var(--surface-elevated);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            color: var(--text-primary);
            padding: 0.5rem;
            width: 120px;
            cursor: pointer;
        }

        .settings-select:focus {
            outline: none;
            border-color: var(--primary);
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: 6px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            border: none;
        }

        .btn-primary {
            background-color: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--primary-dark);
        }

        .btn-secondary {
            background-color: transparent;
            color: var(--text-primary);
            border: 1px solid var(--border);
        }

        .btn-secondary:hover {
            background-color: var(--surface-highlight);
        }

        /* Toast Notifications */
        .toast-container {
            position: fixed;
            bottom: 1.5rem;
            right: 1.5rem;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .toast {
            background-color: var(--surface-elevated);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 1rem 1.25rem;
            box-shadow: var(--shadow-lg);
            display: flex;
            align-items: center;
            gap: 0.75rem;
            min-width: 300px;
            animation: slideIn 0.3s ease, slideOut 0.3s ease 2.7s forwards;
            opacity: 0;
            transform: translateX(100%);
        }

        @keyframes slideIn {
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes slideOut {
            to {
                opacity: 0;
                transform: translateX(100%);
            }
        }

        .toast-icon {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .toast.success .toast-icon {
            background-color: var(--success);
            color: white;
        }

        .toast.error .toast-icon {
            background-color: var(--error);
            color: white;
        }

        .toast.warning .toast-icon {
            background-color: var(--warning);
            color: white;
        }

        .toast-message {
            flex: 1;
        }

        .toast-title {
            font-weight: 500;
            margin-bottom: 0.25rem;
        }

        .toast-description {
            font-size: 0.875rem;
            color: var(--text-tertiary);
        }

        /* Mobile Responsiveness */
        @media (max-width: 768px) {
            .sidebar {
                position: fixed;
                left: -260px;
                height: 100vh;
                z-index: 20;
                box-shadow: var(--shadow-lg);
            }

            .sidebar.active {
                left: 0;
            }

            .mobile-menu-btn {
                display: block;
            }

            .message {
                max-width: 95%;
            }

            .settings-panel {
                width: 100%;
                right: -100%;
            }

            .toast-container {
                left: 1.5rem;
                right: 1.5rem;
            }

            .toast {
                min-width: auto;
            }
            
            /* Mobile-specific adjustments */
            .chat-messages {
                padding: 1rem;
            }
            
            .chat-input-container {
                padding: 1rem;
            }
            
            .header {
                padding: 0 1rem;
            }
            
            .header-title {
                font-size: 1rem;
            }
            
            .message-content {
                padding: 0.75rem 1rem;
                font-size: 0.95rem;
            }
            
            .code-header {
                padding: 0.4rem 0.8rem;
                font-size: 0.8rem;
            }
            
            .copy-btn {
                padding: 0.2rem 0.4rem;
                font-size: 0.7rem;
            }
        }

        /* Loading Spinner */
        .spinner {
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--surface);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--surface-elevated);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--surface-highlight);
        }

        /* Overlay */
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 15;
            display: none;
        }

        .overlay.active {
            display: block;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <a href="#" class="logo">
                    <div class="logo-icon"></div>
                    <span class="logo-text">Nexariq AI</span>
                </a>
                <button class="new-chat-btn" id="newChatBtn">
                    <i class="fas fa-plus"></i>
                    <span>New Chat</span>
                </button>
            </div>
            <div class="chat-history">
                <div class="chat-history-title">Recent Chats</div>
                <div id="chatHistory">
                    <div class="chat-item active">
                        <div class="chat-item-icon">
                            <i class="fas fa-comment"></i>
                        </div>
                        <div class="chat-item-content">
                            <div class="chat-item-title">Current Conversation</div>
                            <div class="chat-item-date">Just now</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="sidebar-footer">
                <div class="user-menu" id="userMenu">
                    <div class="user-avatar">U</div>
                    <div class="user-info">
                        <div class="user-name">User Name</div>
                        <div class="user-email">user@example.com</div>
                    </div>
                    <i class="fas fa-chevron-up"></i>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Header -->
            <div class="header">
                <div class="header-left">
                    <button class="mobile-menu-btn" id="mobileMenuBtn">
                        <i class="fas fa-bars"></i>
                    </button>
                    <div class="header-title">Nexariq AI</div>
                </div>
                <div class="header-actions">
                    <button class="header-btn" id="knowledgeBtn" title="Knowledge Base">
                        <i class="fas fa-book"></i>
                    </button>
                    <button class="header-btn" id="projectsBtn" title="Projects">
                        <i class="fas fa-folder"></i>
                    </button>
                    <button class="header-btn" id="toolsBtn" title="Tools">
                        <i class="fas fa-tools"></i>
                    </button>
                    <button class="header-btn" id="settingsBtn" title="Settings">
                        <i class="fas fa-cog"></i>
                    </button>
                </div>
            </div>

            <!-- Chat Container -->
            <div class="chat-container">
                <div class="chat-messages" id="chatMessages">
                    <div class="message ai">
                        <div class="message-avatar"></div>
                        <div class="message-content">
                            <div class="message-text">
                                <h2>Hello! I'm <strong>Lynxa</strong></h2>
                                <p>I'm an advanced AI assistant developed by <strong>Nexariq (AJ STUDIOZ)</strong>. I can help you with a wide range of tasks:</p>
                                <ul>
                                    <li>Answering questions and providing information</li>
                                    <li>Generating and executing code in multiple languages</li>
                                    <li>Creating and analyzing documents</li>
                                    <li>Web scraping and data extraction</li>
                                    <li>Image generation and analysis</li>
                                    <li>Complex multi-step tasks and workflows</li>
                                </ul>
                                <p>I have access to various tools and can execute code in a secure sandbox environment. How can I assist you today?</p>
                            </div>
                            <div class="message-actions">
                                <button class="message-action-btn" title="Copy" onclick="copyMessage('welcome-message')">
                                    <i class="fas fa-copy"></i>
                                </button>
                                <button class="message-action-btn" title="Good response">
                                    <i class="fas fa-thumbs-up"></i>
                                </button>
                                <button class="message-action-btn" title="Bad response">
                                    <i class="fas fa-thumbs-down"></i>
                                </button>
                            </div>
                            <div class="message-time">Just now</div>
                        </div>
                    </div>
                </div>

                <div class="chat-input-container">
                    <div class="chat-input-wrapper">
                        <textarea class="chat-input" id="chatInput" placeholder="Message Lynxa..." rows="1"></textarea>
                        <div class="chat-actions">
                            <button class="chat-action-btn" id="attachBtn" title="Attach file">
                                <i class="fas fa-paperclip"></i>
                            </button>
                            <button class="chat-send-btn" id="sendBtn">
                                <i class="fas fa-paper-plane"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Settings Panel -->
    <div class="settings-panel" id="settingsPanel">
        <div class="settings-header">
            <div class="settings-title">Settings</div>
            <button class="settings-close" id="settingsClose">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="settings-content">
            <div class="settings-section">
                <div class="settings-section-title">Model Configuration</div>
                <div class="form-group">
                    <label for="model" class="form-label">AI Model</label>
                    <select id="model" class="form-input">
                        <option value="llama-3.3-70b-versatile" selected>Llama 3.3 70B Versatile</option>
                    </select>
                    <p class="form-text">The Llama 3.3 70B model is used for all conversations</p>
                </div>
            </div>
            
            <div class="settings-section">
                <div class="settings-section-title">Appearance</div>
                <div class="settings-item">
                    <div>
                        <div class="settings-label">Theme</div>
                        <div class="settings-description">Choose the app theme</div>
                    </div>
                    <select class="settings-select" id="themeSelect">
                        <option value="dark">Dark</option>
                        <option value="light">Light</option>
                        <option value="system">System</option>
                    </select>
                </div>
                <div class="settings-item">
                    <div>
                        <div class="settings-label">Font Size</div>
                        <div class="settings-description">Adjust the font size</div>
                    </div>
                    <select class="settings-select" id="fontSizeSelect">
                        <option value="small">Small</option>
                        <option value="medium" selected>Medium</option>
                        <option value="large">Large</option>
                    </select>
                </div>
                <div class="settings-item">
                    <div>
                        <div class="settings-label">Typing Speed</div>
                        <div class="settings-description">Adjust AI response typing speed</div>
                    </div>
                    <select class="settings-select" id="typingSpeedSelect">
                        <option value="slow">Slow</option>
                        <option value="medium" selected>Medium</option>
                        <option value="fast">Fast</option>
                        <option value="instant">Instant</option>
                    </select>
                </div>
            </div>
            
            <div class="settings-section">
                <div class="settings-section-title">Features</div>
                <div class="settings-item">
                    <div>
                        <div class="settings-label">Auto-execute Code</div>
                        <div class="settings-description">Automatically execute code snippets</div>
                    </div>
                    <div class="settings-toggle" id="autoExecuteToggle">
                        <div class="settings-toggle-slider"></div>
                    </div>
                </div>
                <div class="settings-item">
                    <div>
                        <div class="settings-label">Sandbox Preview</div>
                        <div class="settings-description">Show preview of sandbox execution</div>
                    </div>
                    <div class="settings-toggle active" id="sandboxPreviewToggle">
                        <div class="settings-toggle-slider"></div>
                    </div>
                </div>
                <div class="settings-item">
                    <div>
                        <div class="settings-label">Agentic Workflows</div>
                        <div class="settings-description">Enable advanced agentic features</div>
                    </div>
                    <div class="settings-toggle active" id="agenticToggle">
                        <div class="settings-toggle-slider"></div>
                    </div>
                </div>
            </div>
            
            <div class="settings-section">
                <div class="settings-section-title">Notifications</div>
                <div class="settings-item">
                    <div>
                        <div class="settings-label">Task Completion</div>
                        <div class="settings-description">Notify when tasks are completed</div>
                    </div>
                    <div class="settings-toggle active" id="taskNotificationToggle">
                        <div class="settings-toggle-slider"></div>
                    </div>
                </div>
                <div class="settings-item">
                    <div>
                        <div class="settings-label">Error Alerts</div>
                        <div class="settings-description">Notify when errors occur</div>
                    </div>
                    <div class="settings-toggle active" id="errorNotificationToggle">
                        <div class="settings-toggle-slider"></div>
                    </div>
                </div>
            </div>
            
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelSettingsBtn">Cancel</button>
                <button class="btn btn-primary" id="saveSettingsBtn">Save</button>
            </div>
        </div>
    </div>

    <!-- Overlay -->
    <div class="overlay" id="overlay"></div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <script>
        // Global state
        const state = {
            messages: [],
            chatHistory: [],
            currentChatId: null,
            isTyping: false,
            tools: {
                python: false,
                javascript: false,
                webScraping: false,
                document: false,
                dataAnalysis: false,
                imageGen: false,
                audio: false,
                researchAgent: false,
                workflow: false
            },
            settings: {
                theme: 'dark',
                fontSize: 'medium',
                typingSpeed: 'medium',
                autoExecute: false,
                sandboxPreview: true,
                agentic: true,
                taskNotifications: true,
                errorNotifications: true
            },
            uploadedFiles: [],
            activeTasks: [],
            workflows: [],
            sandbox: {
                activeTab: 'python',
                code: '',
                output: '',
                preview: ''
            },
            selectedModel: 'llama-3.3-70b-versatile'
        };

        // Typing speeds (characters per millisecond)
        const typingSpeeds = {
            slow: 50,
            medium: 30,
            fast: 15,
            instant: 0
        };

        // DOM Elements
        const elements = {
            sidebar: document.getElementById('sidebar'),
            mobileMenuBtn: document.getElementById('mobileMenuBtn'),
            newChatBtn: document.getElementById('newChatBtn'),
            chatHistory: document.getElementById('chatHistory'),
            chatMessages: document.getElementById('chatMessages'),
            chatInput: document.getElementById('chatInput'),
            sendBtn: document.getElementById('sendBtn'),
            attachBtn: document.getElementById('attachBtn'),
            toolsBtn: document.getElementById('toolsBtn'),
            knowledgeBtn: document.getElementById('knowledgeBtn'),
            projectsBtn: document.getElementById('projectsBtn'),
            settingsBtn: document.getElementById('settingsBtn'),
            settingsPanel: document.getElementById('settingsPanel'),
            settingsClose: document.getElementById('settingsClose'),
            modelSelect: document.getElementById('model'),
            saveSettingsBtn: document.getElementById('saveSettingsBtn'),
            cancelSettingsBtn: document.getElementById('cancelSettingsBtn'),
            overlay: document.getElementById('overlay'),
            toastContainer: document.getElementById('toastContainer'),
            userMenu: document.getElementById('userMenu'),
            themeSelect: document.getElementById('themeSelect'),
            fontSizeSelect: document.getElementById('fontSizeSelect'),
            typingSpeedSelect: document.getElementById('typingSpeedSelect'),
            autoExecuteToggle: document.getElementById('autoExecuteToggle'),
            sandboxPreviewToggle: document.getElementById('sandboxPreviewToggle'),
            agenticToggle: document.getElementById('agenticToggle'),
            taskNotificationToggle: document.getElementById('taskNotificationToggle'),
            errorNotificationToggle: document.getElementById('errorNotificationToggle')
        };

        // Initialize app
        document.addEventListener('DOMContentLoaded', () => {
            loadState();
            setupEventListeners();
            initializeChat();
            applySettings();
        });

        // Load state from localStorage
        function loadState() {
            try {
                const savedState = localStorage.getItem('nexariqState');
                if (savedState) {
                    const parsedState = JSON.parse(savedState);
                    state.messages = parsedState.messages || [];
                    state.chatHistory = parsedState.chatHistory || [];
                    state.settings = { ...state.settings, ...parsedState.settings };
                    state.currentChatId = parsedState.currentChatId;
                    state.workflows = parsedState.workflows || [];
                    state.selectedModel = parsedState.selectedModel || 'llama-3.3-70b-versatile';
                    
                    // Update model select
                    if (elements.modelSelect) {
                        elements.modelSelect.value = state.selectedModel;
                    }
                    
                    renderChatHistory();
                    if (state.currentChatId) {
                        loadChat(state.currentChatId);
                    }
                }
            } catch (error) {
                console.error('Error loading state:', error);
            }
        }

        // Save state to localStorage
        function saveState() {
            try {
                const stateToSave = {
                    messages: state.messages,
                    chatHistory: state.chatHistory,
                    settings: state.settings,
                    currentChatId: state.currentChatId,
                    workflows: state.workflows,
                    selectedModel: state.selectedModel
                };
                localStorage.setItem('nexariqState', JSON.stringify(stateToSave));
            } catch (error) {
                console.error('Error saving state:', error);
            }
        }

        // Setup event listeners
        function setupEventListeners() {
            // Mobile menu
            elements.mobileMenuBtn.addEventListener('click', toggleSidebar);
            elements.overlay.addEventListener('click', closeSidebar);
            
            // New chat
            elements.newChatBtn.addEventListener('click', startNewChat);
            
            // Chat input
            elements.chatInput.addEventListener('keydown', handleChatInputKeydown);
            elements.chatInput.addEventListener('input', autoResizeTextarea);
            elements.sendBtn.addEventListener('click', sendMessage);
            
            // Attach file
            elements.attachBtn.addEventListener('click', attachFile);
            
            // Settings panel
            elements.settingsBtn.addEventListener('click', toggleSettingsPanel);
            elements.settingsClose.addEventListener('click', closeSettingsPanel);
            elements.saveSettingsBtn.addEventListener('click', saveSettings);
            elements.cancelSettingsBtn.addEventListener('click', closeSettingsPanel);
            
            // User menu
            elements.userMenu.addEventListener('click', toggleUserMenu);
            
            // Settings
            elements.themeSelect.addEventListener('change', updateTheme);
            elements.fontSizeSelect.addEventListener('change', updateFontSize);
            elements.typingSpeedSelect.addEventListener('change', updateTypingSpeed);
            elements.autoExecuteToggle.addEventListener('click', toggleAutoExecute);
            elements.sandboxPreviewToggle.addEventListener('click', toggleSandboxPreview);
            elements.agenticToggle.addEventListener('click', toggleAgentic);
            elements.taskNotificationToggle.addEventListener('click', toggleTaskNotifications);
            elements.errorNotificationToggle.addEventListener('click', toggleErrorNotifications);
            
            // Window resize
            window.addEventListener('resize', handleWindowResize);
        }

        // Initialize chat
        function initializeChat() {
            if (state.messages.length === 0) {
                // Add welcome message
                state.messages.push({
                    id: 'welcome-message',
                    role: 'assistant',
                    content: `## Hello! I'm **Lynxa**

I'm an advanced AI assistant developed by **Nexariq (AJ STUDIOZ)**. I can help you with a wide range of tasks:

* Answering questions and providing information
* Generating and executing code in multiple languages
* Creating and analyzing documents
* Web scraping and data extraction
* Image generation and analysis
* Complex multi-step tasks and workflows

I have access to various tools and can execute code in a secure sandbox environment. How can I assist you today?`,
                    timestamp: new Date().toISOString()
                });
                renderMessages();
            } else {
                renderMessages();
            }
        }

        // Apply settings
        function applySettings() {
            // Apply theme
            document.documentElement.setAttribute('data-theme', state.settings.theme);
            
            // Apply font size
            document.body.classList.remove('font-small', 'font-medium', 'font-large');
            document.body.classList.add(`font-${state.settings.fontSize}`);
            
            // Update settings UI
            elements.themeSelect.value = state.settings.theme;
            elements.fontSizeSelect.value = state.settings.fontSize;
            elements.typingSpeedSelect.value = state.settings.typingSpeed;
            
            if (state.settings.autoExecute) {
                elements.autoExecuteToggle.classList.add('active');
            }
            
            if (state.settings.sandboxPreview) {
                elements.sandboxPreviewToggle.classList.add('active');
            }
            
            if (state.settings.agentic) {
                elements.agenticToggle.classList.add('active');
            }
            
            if (state.settings.taskNotifications) {
                elements.taskNotificationToggle.classList.add('active');
            }
            
            if (state.settings.errorNotifications) {
                elements.errorNotificationToggle.classList.add('active');
            }
        }

        // Toggle sidebar
        function toggleSidebar() {
            elements.sidebar.classList.toggle('active');
            elements.overlay.classList.toggle('active');
        }

        // Close sidebar
        function closeSidebar() {
            elements.sidebar.classList.remove('active');
            elements.overlay.classList.remove('active');
        }

        // Start new chat
        function startNewChat() {
            // Save current chat if it has messages
            if (state.messages.length > 1) {
                const title = state.messages[1].content.substring(0, 30) + '...';
                const chatId = generateId();
                
                state.chatHistory.unshift({
                    id: chatId,
                    title,
                    messages: [...state.messages],
                    timestamp: new Date().toISOString()
                });
                
                state.currentChatId = chatId;
                renderChatHistory();
                saveState();
            }
            
            // Clear messages
            state.messages = [];
            state.currentChatId = null;
            
            // Add welcome message
            state.messages.push({
                id: generateId(),
                role: 'assistant',
                content: `## Hello! I'm **Lynxa**

I'm an advanced AI assistant developed by **Nexariq (AJ STUDIOZ)**. How can I assist you today?`,
                timestamp: new Date().toISOString()
            });
            
            renderMessages();
            saveState();
            
            // Update active chat in sidebar
            document.querySelectorAll('.chat-item').forEach(item => {
                item.classList.remove('active');
            });
            
            const activeChat = document.createElement('div');
            activeChat.className = 'chat-item active';
            activeChat.innerHTML = `
                <div class="chat-item-icon">
                    <i class="fas fa-comment"></i>
                </div>
                <div class="chat-item-content">
                    <div class="chat-item-title">Current Conversation</div>
                    <div class="chat-item-date">Just now</div>
                </div>
            `;
            
            elements.chatHistory.insertBefore(activeChat, elements.chatHistory.firstChild);
            
            showToast('New chat started', 'success');
        }

        // Load chat
        function loadChat(chatId) {
            const chat = state.chatHistory.find(c => c.id === chatId);
            if (!chat) return;
            
            state.messages = [...chat.messages];
            state.currentChatId = chatId;
            renderMessages();
            saveState();
            
            // Update active chat in sidebar
            document.querySelectorAll('.chat-item').forEach(item => {
                item.classList.remove('active');
            });
            
            event.currentTarget.classList.add('active');
        }

        // Render chat history
        function renderChatHistory() {
            elements.chatHistory.innerHTML = '';
            
            // Add current chat if no active chat
            if (!state.currentChatId || state.messages.length > 0) {
                const activeChat = document.createElement('div');
                activeChat.className = 'chat-item active';
                activeChat.innerHTML = `
                    <div class="chat-item-icon">
                        <i class="fas fa-comment"></i>
                    </div>
                    <div class="chat-item-content">
                        <div class="chat-item-title">Current Conversation</div>
                        <div class="chat-item-date">Just now</div>
                    </div>
                `;
                elements.chatHistory.appendChild(activeChat);
            }
            
            // Add chat history
            state.chatHistory.forEach(chat => {
                const chatItem = document.createElement('div');
                chatItem.className = 'chat-item';
                chatItem.onclick = () => loadChat(chat.id);
                
                const date = new Date(chat.timestamp);
                const formattedDate = date.toLocaleDateString();
                
                chatItem.innerHTML = `
                    <div class="chat-item-icon">
                        <i class="fas fa-comment"></i>
                    </div>
                    <div class="chat-item-content">
                        <div class="chat-item-title">${chat.title}</div>
                        <div class="chat-item-date">${formattedDate}</div>
                    </div>
                `;
                
                elements.chatHistory.appendChild(chatItem);
            });
        }

        // Render messages
        function renderMessages() {
            elements.chatMessages.innerHTML = '';
            
            state.messages.forEach(message => {
                const messageEl = document.createElement('div');
                messageEl.className = `message ${message.role === 'assistant' ? 'ai' : message.role}`;
                
                const avatar = message.role === 'user' ? 'U' : '';
                const time = new Date(message.timestamp).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
                
                messageEl.innerHTML = `
                    <div class="message-avatar">${avatar}</div>
                    <div class="message-content">
                        <div class="message-text">${formatMessageContent(message.content)}</div>
                        ${message.role === 'assistant' ? `
                            <div class="message-actions">
                                <button class="message-action-btn" title="Copy" onclick="copyMessage('${message.id}')">
                                    <i class="fas fa-copy"></i>
                                </button>
                                <button class="message-action-btn" title="Good response">
                                    <i class="fas fa-thumbs-up"></i>
                                </button>
                                <button class="message-action-btn" title="Bad response">
                                    <i class="fas fa-thumbs-down"></i>
                                </button>
                            </div>
                        ` : ''}
                        <div class="message-time">${time}</div>
                    </div>
                `;
                
                elements.chatMessages.appendChild(messageEl);
            });
            
            // Scroll to bottom
            elements.chatMessages.scrollTop = elements.chatMessages.scrollHeight;
            
            // Highlight code blocks
            setTimeout(() => {
                elements.chatMessages.querySelectorAll('pre code').forEach(block => {
                    hljs.highlightElement(block);
                });
            }, 0);
        }

        // Format message content (markdown to HTML)
        function formatMessageContent(content) {
            // Use marked to parse markdown
            const html = marked.parse(content);
            
            // Process code blocks
            const processedHtml = html.replace(/<pre><code class="language-([^"]+)">([\s\S]*?)<\/code><\/pre>/g, (match, language, code) => {
                const codeId = 'code-' + Math.random().toString(36).substr(2, 9);
                const escapedCode = code.replace(/</g, '&lt;').replace(/>/g, '&gt;');
                
                return `
                    <div class="code-block">
                        <div class="code-header">
                            <div class="code-language">${language}</div>
                            <button class="copy-btn" onclick="copyCode('${codeId}')">
                                <i class="fas fa-copy"></i>
                                <span>Copy</span>
                            </button>
                        </div>
                        <pre><code id="${codeId}" class="language-${language}">${escapedCode}</code></pre>
                    </div>
                `;
            });
            
            // Sanitize HTML
            return DOMPurify.sanitize(processedHtml);
        }

        // Handle chat input keydown
        function handleChatInputKeydown(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        }

        // Auto resize textarea
        function autoResizeTextarea() {
            elements.chatInput.style.height = 'auto';
            elements.chatInput.style.height = Math.min(elements.chatInput.scrollHeight, 200) + 'px';
        }

        // Send message
        async function sendMessage() {
            const message = elements.chatInput.value.trim();
            if (!message || state.isTyping) return;
            
            // Add user message
            const userMessage = {
                id: generateId(),
                role: 'user',
                content: message,
                timestamp: new Date().toISOString()
            };
            
            state.messages.push(userMessage);
            renderMessages();
            saveState();
            
            // Clear input
            elements.chatInput.value = '';
            elements.chatInput.style.height = 'auto';
            
            // Show typing indicator
            showTypingIndicator();
            
            try {
                // Prepare messages for API
                const systemMessage = {
                    role: 'system',
                    content: 'You are Lynxa, an advanced AI assistant developed by Nexariq (AJ STUDIOZ). Provide clear, concise answers with proper formatting. Use markdown for formatting, including code blocks with syntax highlighting for any code examples.'
                };
                
                // Convert messages to API format
                const apiMessages = [systemMessage];
                
                // Add conversation history, skipping the first message if it's the welcome message
                const messagesToInclude = state.messages.length > 1 && state.messages[0].role === 'assistant' 
                    ? state.messages.slice(1) 
                    : state.messages;
                
                messagesToInclude.forEach(msg => {
                    apiMessages.push({
                        role: msg.role === 'assistant' ? 'assistant' : 'user',
                        content: msg.content
                    });
                });
                
                // Send request to our backend API
                const response = await fetch('/api/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        messages: apiMessages,
                        model: state.selectedModel || 'llama-3.3-70b-versatile'
                    })
                });
                
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error || 'API request failed');
                }
                
                const data = await response.json();
                const aiResponse = data.choices[0].message.content;
                
                // Remove typing indicator
                hideTypingIndicator();
                
                // Add AI response with typing effect
                addAIMessageWithTyping(aiResponse);
                
            } catch (error) {
                console.error('Error:', error);
                hideTypingIndicator();
                
                // Add error message with typing effect
                addAIMessageWithTyping(`I'm sorry, I encountered an error: ${error.message}`);
                
                if (state.settings.errorNotifications) {
                    showToast('Error processing your request', 'error');
                }
            } finally {
                // Re-enable send button
                state.isTyping = false;
                elements.sendBtn.disabled = false;
                elements.chatInput.focus();
            }
        }

        // Add AI message with typing effect
        function addAIMessageWithTyping(content) {
            const messageId = generateId();
            const timestamp = new Date().toISOString();
            
            // Create message element
            const messageEl = document.createElement('div');
            messageEl.className = 'message ai';
            messageEl.id = `message-${messageId}`;
            
            const time = new Date(timestamp).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            
            messageEl.innerHTML = `
                <div class="message-avatar"></div>
                <div class="message-content">
                    <div class="message-text typing-text" id="text-${messageId}"></div>
                    <div class="message-actions">
                        <button class="message-action-btn" title="Copy" onclick="copyMessage('${messageId}')">
                            <i class="fas fa-copy"></i>
                        </button>
                        <button class="message-action-btn" title="Good response">
                            <i class="fas fa-thumbs-up"></i>
                        </button>
                        <button class="message-action-btn" title="Bad response">
                            <i class="fas fa-thumbs-down"></i>
                        </button>
                    </div>
                    <div class="message-time">${time}</div>
                </div>
            `;
            
            elements.chatMessages.appendChild(messageEl);
            
            // Add to state
            state.messages.push({
                id: messageId,
                role: 'assistant',
                content,
                timestamp
            });
            
            // Get typing speed
            const typingSpeed = typingSpeeds[state.settings.typingSpeed] || typingSpeeds.medium;
            
            // Start typing effect
            typeText(content, `text-${messageId}`, typingSpeed, () => {
                // Highlight code blocks after typing is complete
                messageEl.querySelectorAll('pre code').forEach(block => {
                    hljs.highlightElement(block);
                });
                
                // Save state after typing is complete
                saveState();
            });
            
            // Scroll to bottom
            elements.chatMessages.scrollTop = elements.chatMessages.scrollHeight;
        }

        // Type text with typing effect
        function typeText(text, elementId, speed, callback) {
            const element = document.getElementById(elementId);
            if (!element) return;
            
            let i = 0;
            const isCodeBlock = text.includes('```');
            
            // If instant, just set the content and return
            if (speed === 0) {
                element.innerHTML = formatMessageContent(text);
                if (callback) callback();
                return;
            }
            
            function type() {
                if (i < text.length) {
                    // Check if we're at a code block
                    if (text.substring(i, i + 3) === '```') {
                        // Find the end of the code block
                        const endOfCodeBlock = text.indexOf('```', i + 3);
                        if (endOfCodeBlock !== -1) {
                            // Add the entire code block at once
                            const codeBlock = text.substring(i, endOfCodeBlock + 3);
                            element.innerHTML = formatMessageContent(text.substring(0, endOfCodeBlock + 3));
                            i = endOfCodeBlock + 3;
                            
                            // Continue typing after a short delay
                            setTimeout(type, speed * 10);
                            return;
                        }
                    }
                    
                    // Add one character at a time
                    element.innerHTML = formatMessageContent(text.substring(0, i + 1));
                    i++;
                    
                    // Continue typing
                    setTimeout(type, speed);
                } else if (callback) {
                    callback();
                }
            }
            
            type();
        }

        // Show typing indicator
        function showTypingIndicator() {
            state.isTyping = true;
            elements.sendBtn.disabled = true;
            
            const typingIndicator = document.createElement('div');
            typingIndicator.className = 'message ai';
            typingIndicator.id = 'typingIndicator';
            
            typingIndicator.innerHTML = `
                <div class="message-avatar"></div>
                <div class="message-content">
                    <div class="typing-indicator">
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                    </div>
                </div>
            `;
            
            elements.chatMessages.appendChild(typingIndicator);
            elements.chatMessages.scrollTop = elements.chatMessages.scrollHeight;
        }

        // Hide typing indicator
        function hideTypingIndicator() {
            state.isTyping = false;
            elements.sendBtn.disabled = false;
            
            const typingIndicator = document.getElementById('typingIndicator');
            if (typingIndicator) {
                typingIndicator.remove();
            }
        }

        // Attach file
        function attachFile() {
            const input = document.createElement('input');
            input.type = 'file';
            input.multiple = true;
            input.onchange = handleFileSelect;
            input.click();
        }

        // Handle file select
        function handleFileSelect(event) {
            const files = event.target.files;
            
            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                const fileId = generateId();
                
                state.uploadedFiles.push({
                    id: fileId,
                    name: file.name,
                    size: file.size,
                    type: file.type,
                    file: file
                });
                
                // Add file to chat
                const fileMessage = {
                    id: generateId(),
                    role: 'user',
                    content: `Attached file: ${file.name} (${formatFileSize(file.size)})`,
                    timestamp: new Date().toISOString(),
                    attachments: [{
                        id: fileId,
                        name: file.name,
                        size: file.size,
                        type: file.type
                    }]
                };
                
                state.messages.push(fileMessage);
            }
            
            renderMessages();
            saveState();
            
            showToast(`${files.length} file(s) attached`, 'success');
        }

        // Format file size
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        // Toggle settings panel
        function toggleSettingsPanel() {
            elements.settingsPanel.classList.toggle('active');
        }

        // Close settings panel
        function closeSettingsPanel() {
            elements.settingsPanel.classList.remove('active');
        }

        // Save settings
        function saveSettings() {
            state.selectedModel = elements.modelSelect.value;
            
            saveState();
            showToast('Settings saved successfully', 'success');
            closeSettingsPanel();
        }

        // Toggle user menu
        function toggleUserMenu() {
            // In a real app, this would show a dropdown menu
            showToast('User menu', 'success');
        }

        // Update theme
        function updateTheme() {
            state.settings.theme = elements.themeSelect.value;
            document.documentElement.setAttribute('data-theme', state.settings.theme);
            saveState();
            showToast('Theme updated', 'success');
        }

        // Update font size
        function updateFontSize() {
            state.settings.fontSize = elements.fontSizeSelect.value;
            document.body.classList.remove('font-small', 'font-medium', 'font-large');
            document.body.classList.add(`font-${state.settings.fontSize}`);
            saveState();
            showToast('Font size updated', 'success');
        }

        // Update typing speed
        function updateTypingSpeed() {
            state.settings.typingSpeed = elements.typingSpeedSelect.value;
            saveState();
            showToast(`Typing speed set to ${state.settings.typingSpeed}`, 'success');
        }

        // Toggle auto execute
        function toggleAutoExecute() {
            state.settings.autoExecute = !state.settings.autoExecute;
            elements.autoExecuteToggle.classList.toggle('active');
            saveState();
            showToast(`Auto-execute ${state.settings.autoExecute ? 'enabled' : 'disabled'}`, 'success');
        }

        // Toggle sandbox preview
        function toggleSandboxPreview() {
            state.settings.sandboxPreview = !state.settings.sandboxPreview;
            elements.sandboxPreviewToggle.classList.toggle('active');
            saveState();
            showToast(`Sandbox preview ${state.settings.sandboxPreview ? 'enabled' : 'disabled'}`, 'success');
        }

        // Toggle agentic
        function toggleAgentic() {
            state.settings.agentic = !state.settings.agentic;
            elements.agenticToggle.classList.toggle('active');
            saveState();
            showToast(`Agentic features ${state.settings.agentic ? 'enabled' : 'disabled'}`, 'success');
        }

        // Toggle task notifications
        function toggleTaskNotifications() {
            state.settings.taskNotifications = !state.settings.taskNotifications;
            elements.taskNotificationToggle.classList.toggle('active');
            saveState();
            showToast(`Task notifications ${state.settings.taskNotifications ? 'enabled' : 'disabled'}`, 'success');
        }

        // Toggle error notifications
        function toggleErrorNotifications() {
            state.settings.errorNotifications = !state.settings.errorNotifications;
            elements.errorNotificationToggle.classList.toggle('active');
            saveState();
            showToast(`Error notifications ${state.settings.errorNotifications ? 'enabled' : 'disabled'}`, 'success');
        }

        // Handle window resize
        function handleWindowResize() {
            if (window.innerWidth > 768) {
                elements.sidebar.classList.remove('active');
                elements.overlay.classList.remove('active');
            }
        }

        // Show toast notification
        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            
            let icon = '';
            if (type === 'success') icon = 'fas fa-check';
            else if (type === 'error') icon = 'fas fa-times';
            else if (type === 'warning') icon = 'fas fa-exclamation';
            
            toast.innerHTML = `
                <div class="toast-icon">
                    <i class="${icon}"></i>
                </div>
                <div class="toast-message">
                    <div class="toast-title">${type.charAt(0).toUpperCase() + type.slice(1)}</div>
                    <div class="toast-description">${message}</div>
                </div>
            `;
            
            elements.toastContainer.appendChild(toast);
            
            // Auto remove after 3 seconds
            setTimeout(() => {
                toast.style.animation = 'slideOut 0.3s ease forwards';
                setTimeout(() => {
                    if (toast.parentNode) {
                        toast.parentNode.removeChild(toast);
                    }
                }, 300);
            }, 3000);
        }

        // Copy message
        function copyMessage(messageId) {
            const message = state.messages.find(m => m.id === messageId);
            if (!message) return;
            
            navigator.clipboard.writeText(message.content)
                .then(() => {
                    showToast('Message copied to clipboard', 'success');
                })
                .catch(err => {
                    showToast('Failed to copy message', 'error');
                    console.error('Failed to copy:', err);
                });
        }

        // Copy code
        function copyCode(codeId) {
            const codeBlock = document.getElementById(codeId);
            if (!codeBlock) return;
            
            const code = codeBlock.textContent;
            navigator.clipboard.writeText(code)
                .then(() => {
                    const copyBtn = document.querySelector(`button[onclick="copyCode('${codeId}')"]`);
                    const originalHTML = copyBtn.innerHTML;
                    copyBtn.innerHTML = '<i class="fas fa-check"></i> <span>Copied!</span>';
                    copyBtn.classList.add('copied');
                    
                    setTimeout(() => {
                        copyBtn.innerHTML = originalHTML;
                        copyBtn.classList.remove('copied');
                    }, 2000);
                    
                    showToast('Code copied to clipboard', 'success');
                })
                .catch(err => {
                    showToast('Failed to copy code', 'error');
                    console.error('Failed to copy:', err);
                });
        }

        // Generate ID
        function generateId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2);
        }

        // Global functions for onclick handlers
        window.copyMessage = copyMessage;
        window.copyCode = copyCode;
    </script>
</body>
</html>
